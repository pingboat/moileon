{{ define "main" }}

    <div class="logo-section" style="text-align: center;">
        <div class="logo-text">ALL LIFE IS YOGA.</div>
        <div class="lotus-image">
            <img src="{{ "images/lotus.png" | relURL }}" alt="Lotus with Om Symbol">
        </div>
    </div>

    <div class="quiz-section" style="text-align: center;">
        <h1 class="quiz-title">Quest On!</h1>
        <div class="score">Score: <span id="score-display">0</span></div>
        <div class="question" id="question-display">Loading question...</div>
        
        <!-- Embedded quiz data for JavaScript -->
        <script id="quiz-data" type="application/json">
        {{ $quizData := "" }}
        {{ if fileExists "data/questions.json" }}
            {{ $quizData = getJSON "data/questions.json" }}
        {{ else }}
            {{ $quizData = slice 
                (dict "question" "Which company's first product was a line of playing cards in 1889?" "answer" (slice "nintendo" "Nintendo") "explanation" "Nintendo started as a playing card company in Kyoto, Japan, founded by Fusajiro Yamauchi.")
                (dict "question" "What does 'www' stand for in web addresses?" "answer" (slice "world wide web" "World Wide Web") "explanation" "The World Wide Web was invented by Tim Berners-Lee in 1989 while working at CERN.")
                (dict "question" "Which planet is known as the Red Planet?" "answer" (slice "mars" "Mars") "explanation" "Mars appears red due to iron oxide (rust) on its surface.")
            }}
        {{ end }}
        {{ $quizData | jsonify }}
        </script>
        
        <input type="text" class="answer-input" id="answer-input" placeholder="Type your answer here">
        <div class="instruction">Press Enter after typing your answer</div>
        
        <div class="quiz-buttons">
            <button class="button submit-btn">Submit Answer</button>
            <button class="button next-btn">Show me the answer</button>
        </div>
    </div>
    
    <!-- Inline JavaScript for debugging -->
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        console.log("=== QUIZ DEBUG INFO ===");
        
        // Check if elements exist
        const questionElement = document.getElementById("question-display");
        const answerInput = document.getElementById("answer-input");
        const submitButton = document.querySelector(".submit-btn");
        const nextButton = document.querySelector(".next-btn");
        const scoreElement = document.getElementById("score-display");
        const quizDataElement = document.getElementById("quiz-data");
        
        console.log("Question element:", questionElement);
        console.log("Answer input:", answerInput);
        console.log("Submit button:", submitButton);
        console.log("Quiz data element:", quizDataElement);
        
        if (!questionElement) {
            console.error("‚ùå Question element not found!");
            return;
        }
        
        if (!quizDataElement) {
            console.error("‚ùå Quiz data element not found!");
            questionElement.textContent = "‚ö†Ô∏è Quiz data element missing";
            return;
        }
        
        // Try to parse quiz data
        let questions = [];
        try {
            const rawData = quizDataElement.textContent.trim();
            console.log("Raw quiz data:", rawData);
            questions = JSON.parse(rawData);
            console.log("‚úÖ Successfully parsed", questions.length, "questions");
            console.log("First question:", questions[0]);
        } catch (error) {
            console.error("‚ùå Error parsing quiz data:", error);
            questionElement.textContent = "‚ö†Ô∏è Failed to load quiz questions: " + error.message;
            return;
        }
        
        if (questions.length === 0) {
            console.error("‚ùå No questions found in data");
            questionElement.textContent = "‚ö†Ô∏è No questions available";
            return;
        }
        
        // If we get here, everything should work
        console.log("‚úÖ Quiz initialization successful!");
        questionElement.textContent = questions[0].question;
        
        // Add basic functionality
        let currentIndex = 0;
        let score = 0;
        
        submitButton.addEventListener("click", function() {
            const userAnswer = answerInput.value.trim().toLowerCase();
            const currentQ = questions[currentIndex];
            const correctAnswers = Array.isArray(currentQ.answer) ? 
                currentQ.answer.map(a => a.toLowerCase()) : 
                [currentQ.answer.toLowerCase()];
            
            if (correctAnswers.includes(userAnswer)) {
                alert("‚úÖ Correct! " + (currentQ.explanation || ""));
                score++;
                scoreElement.textContent = score;
            } else {
                const correctAnswer = Array.isArray(currentQ.answer) ? currentQ.answer[0] : currentQ.answer;
                alert("‚ùå Incorrect. The answer was: " + correctAnswer + 
                      (currentQ.explanation ? "\n\n" + currentQ.explanation : ""));
            }
            
            // Next question
            currentIndex++;
            if (currentIndex < questions.length) {
                questionElement.textContent = questions[currentIndex].question;
                answerInput.value = "";
            } else {
                questionElement.textContent = "üéâ Quiz completed!";
                const percentage = Math.round((score / questions.length) * 100);
                alert(`Final Score: ${score}/${questions.length} (${percentage}%)`);
            }
        });
        
        nextButton.addEventListener("click", function() {
            const currentQ = questions[currentIndex];
            const correctAnswer = Array.isArray(currentQ.answer) ? currentQ.answer[0] : currentQ.answer;
            alert("üí° The answer is: " + correctAnswer + 
                  (currentQ.explanation ? "\n\n" + currentQ.explanation : ""));
        });
        
        answerInput.addEventListener("keypress", function(e) {
            if (e.key === "Enter") {
                submitButton.click();
            }
        });
    });
    </script>

{{ end }}

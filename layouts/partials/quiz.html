<div class="logo-section" style="text-align: center;">
    <div class="logo-text">ALL LIFE IS YOGA.</div>
    <div class="lotus-image">
        <img src="{{ "images/lotus.png" | relURL }}" alt="Lotus with Om Symbol">
    </div>
</div>

<div class="quiz-section" style="text-align: center;">
    <h1 class="quiz-title">Quest On!</h1>
    <div class="score">Score: <span id="score-display">0</span></div>
    <div class="question" id="question-display">Loading question...</div>
    
    <script id="quiz-data" type="application/json">
    {{ $quizData := getJSON "data/questions.json" }}
    {{ $quizData | jsonify }}
    </script>
    
    <input type="text" class="answer-input" id="answer-input" placeholder="Type your answer here">
    <div class="instruction">Press Enter after typing your answer</div>
    
    <div class="quiz-buttons">
        <button class="button submit-btn">Submit Answer</button>
        <button class="button next-btn">Show me the answer</button>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    let questions = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let answered = false;

    const questionElement = document.getElementById("question-display");
    const answerInput = document.getElementById("answer-input");
    const submitButton = document.querySelector(".submit-btn");
    const nextButton = document.querySelector(".next-btn");
    const scoreElement = document.getElementById("score-display");

    // Check if we're on a quiz page
    if (!questionElement || !answerInput || !submitButton || !scoreElement) {
        return;
    }

    // Load quiz data from embedded script tag
    const quizDataElement = document.getElementById("quiz-data");
    if (quizDataElement && quizDataElement.textContent) {
        try {
            questions = JSON.parse(quizDataElement.textContent);
            questions = shuffleArray(questions);
            showQuestion();
        } catch (error) {
            console.error("Failed to parse quiz data:", error);
            questionElement.textContent = "‚ö†Ô∏è Failed to load quiz questions.";
        }
    } else {
        questionElement.textContent = "‚ö†Ô∏è Quiz data not found.";
    }

    function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }

    function showQuestion() {
        if (currentQuestionIndex >= questions.length) {
            finishQuiz();
            return;
        }
        const currentQuestion = questions[currentQuestionIndex];
        questionElement.textContent = currentQuestion.question;
        answerInput.value = "";
        answerInput.disabled = false;
        answerInput.focus();
        answered = false;
        submitButton.style.display = "inline-block";
        nextButton.style.display = "inline-block";
        nextButton.textContent = "Show me the answer";
        submitButton.textContent = "Submit Answer";
    }

    function getCorrectAnswers(question) {
        if (Array.isArray(question.answer)) {
            return question.answer;
        } else if (typeof question.answer === 'string') {
            return [question.answer];
        } else {
            return ["unknown"];
        }
    }

    function checkAnswer() {
        if (answered) {
            nextQuestion();
            return;
        }
        const userAnswer = answerInput.value.trim().toLowerCase();
        const currentQuestion = questions[currentQuestionIndex];
        const correctAnswers = getCorrectAnswers(currentQuestion).map(ans => ans.toLowerCase());
        const isCorrect = correctAnswers.some(answer => userAnswer === answer);

        if (isCorrect) {
            score++;
            scoreElement.textContent = score;
            alert("‚úÖ Correct!");
        } else {
            const correctAnswer = getCorrectAnswers(currentQuestion)[0];
            alert("‚ùå Incorrect. The correct answer is: " + correctAnswer);
        }

        answered = true;
        answerInput.disabled = true;
        nextButton.textContent = "Next Question";
        submitButton.style.display = "none";
    }

    function showAnswer() {
        const currentQuestion = questions[currentQuestionIndex];
        const correctAnswer = getCorrectAnswers(currentQuestion)[0];
        alert("üí° The answer is: " + correctAnswer);
        
        answered = true;
        answerInput.disabled = true;
        nextButton.textContent = "Next Question";
        submitButton.style.display = "none";
    }

    function nextQuestion() {
        currentQuestionIndex++;
        showQuestion();
    }

    function finishQuiz() {
        questionElement.textContent = "üéâ Quiz completed!";
        alert(`Final Score: ${score}/${questions.length}`);
        nextButton.style.display = "none";
        answerInput.style.display = "none";
        submitButton.textContent = "Restart Quiz";
        submitButton.style.display = "inline-block";
    }

    function restartQuiz() {
        currentQuestionIndex = 0;
        score = 0;
        scoreElement.textContent = score;
        questions = shuffleArray(questions);
        nextButton.style.display = "inline-block";
        answerInput.style.display = "block";
        showQuestion();
    }

    submitButton.addEventListener("click", function() {
        if (submitButton.textContent === "Restart Quiz") {
            restartQuiz();
        } else {
            checkAnswer();
        }
    });

    nextButton.addEventListener("click", function() {
        if (nextButton.textContent === "Next Question") {
            nextQuestion();
        } else {
            showAnswer();
        }
    });
    
    answerInput.addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            checkAnswer();
        }
    });
});
</script>

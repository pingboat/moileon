<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Moileon - Quest On!</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

  <!-- HEADER -->
  <header>
    <h1>Moileon</h1>
    <nav>
      <ul id="nav-menu">
        <!-- Navigation will load from settings/navigation.md -->
      </ul>
    </nav>
  </header>

  <!-- QUIZ SECTION -->
  <section id="quiz-section">
    <h2>Quest On!</h2>
    <div id="quiz-container">
      <!-- Quiz questions will be dynamically loaded -->
    </div>
  </section>

  <!-- QUOTES SECTION -->
  <section id="quotes-section">
    <h2>Quotes</h2>
    <div id="quotes-container">
      <!-- Quotes will be dynamically loaded -->
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <p>&copy; <span id="year"></span> Moileon</p>
  </footer>

  <!-- SCRIPTS -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const yearSpan = document.getElementById("year");
      yearSpan.textContent = new Date().getFullYear();

      // Load navigation
      fetch("/content/settings/navigation.md")
        .then(res => res.text())
        .then(data => {
          const navList = document.getElementById("nav-menu");
          const navItems = parseNavMarkdown(data);
          navItems.forEach(item => {
            const li = document.createElement("li");
            const a = document.createElement("a");
            a.href = item.url;
            a.textContent = item.label;
            if (item.external) a.target = "_blank";
            li.appendChild(a);
            navList.appendChild(li);
          });
        });

      // Load quiz
      fetchQuiz();

      // Load quotes
      fetchQuotes();
    });

    // --- Helper: Parse navigation markdown ---
    function parseNavMarkdown(md) {
      try {
        const json = JSON.parse(md.split("```json")[1].split("```")[0]);
        return json.nav_items || [];
      } catch (e) {
        console.error("Error parsing navigation:", e);
        return [];
      }
    }

    // --- Fetch quiz questions ---
    function fetchQuiz() {
      fetch("/content/quiz")
        .then(res => res.json())
        .then(quizData => {
          const quizContainer = document.getElementById("quiz-container");
          quizData.forEach(q => {
            const div = document.createElement("div");
            div.className = "quiz-card";
            div.innerHTML = `
              <h3>${q.question}</h3>
              <p><strong>Answer:</strong> ${q.correct_answer}</p>
              ${q.explanation ? `<p>${q.explanation}</p>` : ""}
            `;
            quizContainer.appendChild(div);
          });
        })
        .catch(err => console.error("Quiz load error:", err));
    }

    // --- Fetch quotes ---
    function fetchQuotes() {
      fetch("/content/quotes")
        .then(res => res.json())
        .then(quotesData => {
          const quotesContainer = document.getElementById("quotes-container");
          quotesData.forEach(quote => {
            const div = document.createElement("div");
            div.className = "quote-card";

            // Format optional date
            let dateHTML = "";
            if (quote.date) {
              const d = new Date(quote.date);
              dateHTML = `<small class="quote-date">${d.toLocaleDateString()}</small>`;
            }

            div.innerHTML = `
              <blockquote>
                <p>"${quote.quote}"</p>
                <footer>
                  â€” ${quote.author}
                  ${dateHTML}
                </footer>
              </blockquote>
            `;
            quotesContainer.appendChild(div);
          });
        })
        .catch(err => console.error("Quotes load error:", err));
    }
  </script>

</body>
</html>
